@using Proyecto2.Frontend.Models
@using Proyecto2.Frontend.Services
@using MudBlazor
@inject ILibroService LibroService
@inject ISnackbar Snackbar

<div class="max-w-xl mx-auto mt-10 bg-white rounded-xl shadow-md p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">📘 Registrar Libro</h2>

    <MudForm @ref="_form">
        <div class="space-y-6">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Título</label>
                <MudTextField @bind-Value="_libro.Titulo"
                              Required="true"
                              Class="w-full border border-blue-300 rounded-md px-3 py-2 shadow-sm bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Año</label>
                <MudTextField @bind-Value="_libro.Anio"
                              Required="true"
                              Type="number"
                              Class="w-full border border-green-300 rounded-md px-3 py-2 shadow-sm bg-blue-50 focus:outline-none focus:ring-2 focus:ring-green-500" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Género</label>
                <MudTextField @bind-Value="_libro.Genero"
                              Class="w-full border border-yellow-300 rounded-md px-3 py-2 shadow-sm bg-blue-50 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Número de páginas</label>
                <MudTextField @bind-Value="_libro.NumeroPaginas"
                              Type="number"
                              Class="w-full border border-purple-300 rounded-md px-3 py-2 shadow-sm bg-blue-50 focus:outline-none focus:ring-2 focus:ring-purple-500" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">ID del Autor</label>
                <MudTextField @bind-Value="_libro.AutorId"
                              Required="true"
                              Type="number"
                              Class="w-full border border-pink-300 rounded-md px-3 py-2 shadow-sm bg-blue-50 focus:outline-none focus:ring-2 focus:ring-pink-500" />
            </div>

            <MudButton OnClick="Registrar"
                       Variant="Variant.Filled"
                       Style="background-color: rgb(17, 24, 39); color: white;"
                       Size="Size.Medium"
                       Class="w-full mt-6 py-3 text-lg font-semibold shadow-md transition-transform duration-300 ease-in-out hover:scale-105 hover:shadow-lg">
                💾 Guardar Libro
            </MudButton>
        </div>
    </MudForm>
</div>

@code {
    private LibroDto _libro = new();
    private MudForm _form;

    private async Task Registrar()
    {
        await _form.Validate();

        if (_form.IsValid)
        {
            var resultado = await LibroService.CrearAsync(_libro);

            if (resultado)
            {
                Snackbar.Add("📘 Libro registrado correctamente", Severity.Success);
                _libro = new(); // Limpiar
            }
            else
            {
                Snackbar.Add("❌ Error al registrar libro", Severity.Error);
            }
        }
    }
}
