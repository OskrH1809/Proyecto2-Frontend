@using MudBlazor
@inject IAutorService AutorService
@inject ISnackbar Snackbar
@using Proyecto2.Frontend.Services

@using Proyecto2.Frontend.Models

<MudPaper Class="p-6 mx-auto mt-4" Elevation="4" Style="max-width: 600px;">
    <MudText Typo="Typo.h5" GutterBottom="true">Registrar Autor</MudText>

    <MudForm @ref="_form" Model="_autor">
        <MudTextField @bind-Value="_autor.NombreCompleto" Label="Nombre completo" Required="true" />
        <MudTextField @bind-Value="FechaNacimientoString" Label="Fecha de nacimiento" InputType="InputType.Date" Required="true" />
        <MudTextField @bind-Value="_autor.CiudadProcedencia" Label="Ciudad de procedencia" />
        <MudTextField @bind-Value="_autor.CorreoElectronico" Label="Correo electrónico" />

        <MudButton OnClick="SubmitForm" Variant="Variant.Filled" Color="Color.Primary" Class="mt-4">
            Guardar Autor
        </MudButton>
    </MudForm>
</MudPaper>

@code {
    private MudForm _form;
    private AutorDto _autor = new();

    private string FechaNacimientoString
    {
        get => _autor.FechaNacimiento?.ToString("yyyy-MM-dd") ?? "";
        set => _autor.FechaNacimiento = DateTime.TryParse(value, out var parsed) ? parsed : null;
    }

    private async Task SubmitForm()
    {
        await _form.Validate();

        if (_form.IsValid)
        {
            var creado = await AutorService.CrearAsync(_autor);

            if (creado)
            {
                Snackbar.Add("Autor registrado exitosamente", Severity.Success);
                _autor = new();
            }
            else
            {
                Snackbar.Add("Error al registrar autor", Severity.Error);
            }
        }
    }
}
